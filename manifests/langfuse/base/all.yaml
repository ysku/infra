---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/networkpolicy.yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: langfuse-zookeeper
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: zookeeper
  policyTypes:
    - Ingress
    - Egress
  egress:
    - {}
  ingress:
    # Allow inbound connections to ZooKeeper
    - ports:
        - port: 2181
    # Allow internal communications between nodes
    - ports:
        - port: 2888
        - port: 3888
      from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/instance: langfuse
              app.kubernetes.io/name: zookeeper
---
# Source: langfuse/charts/clickhouse/templates/networkpolicy.yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: langfuse-clickhouse
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: clickhouse
      app.kubernetes.io/component: clickhouse
  policyTypes:
    - Ingress
    - Egress
  egress:
    - {}
  ingress:
    - ports:
        - port: 8123
        - port: 9000
        - port: 9004
        - port: 9005
        - port: 9009
---
# Source: langfuse/charts/postgresql/templates/primary/networkpolicy.yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: langfuse-postgresql
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/version: 17.3.0
    helm.sh/chart: postgresql-16.4.9
    app.kubernetes.io/component: primary
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: postgresql
      app.kubernetes.io/component: primary
  policyTypes:
    - Ingress
    - Egress
  egress:
    - {}
  ingress:
    - ports:
        - port: 5432
---
# Source: langfuse/charts/redis/templates/networkpolicy.yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: langfuse-redis
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/part-of: valkey
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: redis
  policyTypes:
    - Ingress
    - Egress
  egress:
    - {}
  ingress:
    # Allow inbound connections
    - ports:
        - port: 6379
---
# Source: langfuse/charts/s3/templates/networkpolicy.yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: s3
  policyTypes:
    - Ingress
    - Egress
  egress:
    - {}
  ingress:
    # Allow inbound connections
    - ports:
        - port: 9001
        - port: 9000
---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: langfuse-zookeeper
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
    app.kubernetes.io/component: zookeeper
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: zookeeper
      app.kubernetes.io/component: zookeeper
---
# Source: langfuse/charts/clickhouse/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: langfuse-clickhouse-shard0
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
    shard: "0"
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: clickhouse
      app.kubernetes.io/component: clickhouse
      shard: "0"
---
# Source: langfuse/charts/postgresql/templates/primary/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: langfuse-postgresql
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/version: 17.3.0
    helm.sh/chart: postgresql-16.4.9
    app.kubernetes.io/component: primary
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: postgresql
      app.kubernetes.io/component: primary
---
# Source: langfuse/charts/s3/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: s3
---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: langfuse-zookeeper
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
    app.kubernetes.io/component: zookeeper
    role: zookeeper
automountServiceAccountToken: false
---
# Source: langfuse/charts/clickhouse/templates/service-account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: langfuse-clickhouse
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
automountServiceAccountToken: false
---
# Source: langfuse/charts/postgresql/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: langfuse-postgresql
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/version: 17.3.0
    helm.sh/chart: postgresql-16.4.9
automountServiceAccountToken: false
---
# Source: langfuse/charts/redis/templates/primary/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
automountServiceAccountToken: false
metadata:
  name: langfuse-redis-primary
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/part-of: valkey
---
# Source: langfuse/charts/s3/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
automountServiceAccountToken: false
secrets:
  - name: langfuse-s3
---
# Source: langfuse/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: langfuse
  namespace: default
  labels:
    helm.sh/chart: langfuse-1.5.12
    app.kubernetes.io/name: langfuse
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/version: "3.133.0"
    app.kubernetes.io/managed-by: Helm
---
# Source: langfuse/charts/s3/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
type: Opaque
data:
  root-user: "bWluaW8="
  root-password: "SFJPQVBUQ3VsbQ=="
---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/scripts-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-zookeeper-scripts
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
    app.kubernetes.io/component: zookeeper
data:
  init-certs.sh: |-
    #!/bin/bash
  setup.sh: |-
    #!/bin/bash

    # Execute entrypoint as usual after obtaining ZOO_SERVER_ID
    # check ZOO_SERVER_ID in persistent volume via myid
    # if not present, set based on POD hostname
    if [[ -f "/bitnami/zookeeper/data/myid" ]]; then
        export ZOO_SERVER_ID="$(cat /bitnami/zookeeper/data/myid)"
    else
        HOSTNAME="$(hostname -s)"
        if [[ $HOSTNAME =~ (.*)-([0-9]+)$ ]]; then
            ORD=${BASH_REMATCH[2]}
            export ZOO_SERVER_ID="$((ORD + 1 ))"
        else
            echo "Failed to get index from hostname $HOSTNAME"
            exit 1
        fi
    fi
    exec /entrypoint.sh /run.sh
---
# Source: langfuse/charts/clickhouse/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-clickhouse
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
data:
  00_default_overrides.xml: |
    <clickhouse>
      <!-- Macros -->
      <macros>
        <shard from_env="CLICKHOUSE_SHARD_ID"></shard>
        <replica from_env="CLICKHOUSE_REPLICA_ID"></replica>
        <layer>langfuse-clickhouse</layer>
      </macros>
      <!-- Log Level -->
      <logger>
        <level>information</level>
      </logger>
      <!-- Zookeeper configuration -->
      <zookeeper>
        
        <node>
          <host from_env="KEEPER_NODE_0"></host>
          <port>2181</port>
        </node>
        <node>
          <host from_env="KEEPER_NODE_1"></host>
          <port>2181</port>
        </node>
        <node>
          <host from_env="KEEPER_NODE_2"></host>
          <port>2181</port>
        </node>
      </zookeeper>
      <listen_host>0.0.0.0</listen_host>
      <listen_host>::</listen_host>
      <listen_try>1</listen_try>
    </clickhouse>
---
# Source: langfuse/charts/clickhouse/templates/scripts-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-clickhouse-scripts
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
data:
  setup.sh: |-
    #!/bin/bash

    # Execute entrypoint as usual after obtaining KEEPER_SERVER_ID
    # check KEEPER_SERVER_ID in persistent volume via myid
    # if not present, set based on POD hostname
    if [[ -f "/bitnami/clickhouse/keeper/data/myid" ]]; then
        export KEEPER_SERVER_ID="$(cat /bitnami/clickhouse/keeper/data/myid)"
    else
        HOSTNAME="$(hostname -s)"
        if [[ $HOSTNAME =~ (.*)-([0-9]+)$ ]]; then
            export KEEPER_SERVER_ID=${BASH_REMATCH[2]}
        else
            echo "Failed to get index from hostname $HOST"
            exit 1
        fi
    fi
    exec /opt/bitnami/scripts/clickhouse/entrypoint.sh /opt/bitnami/scripts/clickhouse/run.sh  "$@"
---
# Source: langfuse/charts/redis/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-redis-configuration
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/part-of: valkey
data:
  valkey.conf: |-
    # User-supplied common configuration:
    # Enable AOF https://valkey.io/docs/topics/persistence.html
    appendonly yes
    # Disable RDB persistence, AOF persistence already enabled.
    save ""
    # End of common configuration
  primary.conf: |-
    dir /data
    # User-supplied primary configuration:
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    # End of primary configuration
  replica.conf: |-
    dir /data
    # User-supplied replica configuration:
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    # End of replica configuration
---
# Source: langfuse/charts/redis/templates/health-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-redis-health
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
data:
  ping_readiness_local.sh: |-
    #!/bin/bash

    [[ -f $VALKEY_PASSWORD_FILE ]] && export VALKEY_PASSWORD="$(< "${VALKEY_PASSWORD_FILE}")"
    [[ -n "$VALKEY_PASSWORD" ]] && export REDISCLI_AUTH="$VALKEY_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      valkey-cli \
        -h localhost \
        -p $VALKEY_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  ping_liveness_local.sh: |-
    #!/bin/bash

    [[ -f $VALKEY_PASSWORD_FILE ]] && export VALKEY_PASSWORD="$(< "${VALKEY_PASSWORD_FILE}")"
    [[ -n "$VALKEY_PASSWORD" ]] && export REDISCLI_AUTH="$VALKEY_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      valkey-cli \
        -h localhost \
        -p $VALKEY_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
    if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ] && [ "$responseFirstWord" != "MASTERDOWN" ]; then
      echo "$response"
      exit 1
    fi
  ping_readiness_primary.sh: |-
    #!/bin/bash

    [[ -f $VALKEY_PRIMARY_PASSWORD_FILE ]] && export VALKEY_PRIMARY_PASSWORD="$(< "${VALKEY_PRIMARY_PASSWORD_FILE}")"
    [[ -n "$VALKEY_PRIMARY_PASSWORD" ]] && export REDISCLI_AUTH="$VALKEY_PRIMARY_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      valkey-cli \
        -h $VALKEY_PRIMARY_HOST \
        -p $VALKEY_PRIMARY_PORT_NUMBER \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  ping_liveness_primary.sh: |-
    #!/bin/bash

    [[ -f $VALKEY_PRIMARY_PASSWORD_FILE ]] && export VALKEY_PRIMARY_PASSWORD="$(< "${VALKEY_PRIMARY_PASSWORD_FILE}")"
    [[ -n "$VALKEY_PRIMARY_PASSWORD" ]] && export REDISCLI_AUTH="$VALKEY_PRIMARY_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      valkey-cli \
        -h $VALKEY_PRIMARY_HOST \
        -p $VALKEY_PRIMARY_PORT_NUMBER \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
    if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ]; then
      echo "$response"
      exit 1
    fi
  ping_readiness_local_and_primary.sh: |-
    script_dir="$(dirname "$0")"
    exit_status=0
    "$script_dir/ping_readiness_local.sh" $1 || exit_status=$?
    "$script_dir/ping_readiness_primary.sh" $1 || exit_status=$?
    exit $exit_status
  ping_liveness_local_and_primary.sh: |-
    script_dir="$(dirname "$0")"
    exit_status=0
    "$script_dir/ping_liveness_local.sh" $1 || exit_status=$?
    "$script_dir/ping_liveness_primary.sh" $1 || exit_status=$?
    exit $exit_status
---
# Source: langfuse/charts/redis/templates/scripts-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: langfuse-redis-scripts
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/part-of: valkey
data:
  start-primary.sh: |
    #!/bin/bash

    [[ -f $VALKEY_PASSWORD_FILE ]] && export VALKEY_PASSWORD="$(< "${VALKEY_PASSWORD_FILE}")"
    if [[ -f /opt/bitnami/valkey/mounted-etc/primary.conf ]];then
        cp /opt/bitnami/valkey/mounted-etc/primary.conf /opt/bitnami/valkey/etc/primary.conf
    fi
    if [[ -f /opt/bitnami/valkey/mounted-etc/valkey.conf ]];then
        cp /opt/bitnami/valkey/mounted-etc/valkey.conf /opt/bitnami/valkey/etc/valkey.conf
    fi
    ARGS=("--port" "${VALKEY_PORT}")
    ARGS+=("--requirepass" "${VALKEY_PASSWORD}")
    ARGS+=("--primaryauth" "${VALKEY_PASSWORD}")
    ARGS+=("--include" "/opt/bitnami/valkey/etc/valkey.conf")
    ARGS+=("--include" "/opt/bitnami/valkey/etc/primary.conf")
    ARGS+=("--maxmemory-policy noeviction")
    exec valkey-server "${ARGS[@]}"
---
# Source: langfuse/charts/s3/templates/pvc.yaml
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
spec:
  accessModes:
    - "ReadWriteOnce"
  resources:
    requests:
      storage: "8Gi"
---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/svc-headless.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-zookeeper-headless
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
    app.kubernetes.io/component: zookeeper
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - name: tcp-client
      port: 2181
      targetPort: client
    - name: tcp-follower
      port: 2888
      targetPort: follower
    - name: tcp-election
      port: 3888
      targetPort: election
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/component: zookeeper
---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-zookeeper
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
    app.kubernetes.io/component: zookeeper
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: tcp-client
      port: 2181
      targetPort: client
      nodePort: null
    - name: tcp-follower
      port: 2888
      targetPort: follower
    - name: tcp-election
      port: 3888
      targetPort: election
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/component: zookeeper
---
# Source: langfuse/charts/clickhouse/templates/service-headless.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-clickhouse-headless
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - name: http
      targetPort: http
      port: 8123
      protocol: TCP
    - name: tcp
      targetPort: tcp
      port: 9000
      protocol: TCP
    - name: tcp-mysql
      targetPort: tcp-mysql
      port: 9004
      protocol: TCP
    - name: tcp-postgresql
      targetPort: tcp-postgresql
      port: 9005
      protocol: TCP
    - name: http-intersrv
      targetPort: http-intersrv
      port: 9009
      protocol: TCP
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/component: clickhouse
---
# Source: langfuse/charts/clickhouse/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-clickhouse
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: http
      targetPort: http
      port: 8123
      protocol: TCP
      nodePort: null
    - name: tcp
      targetPort: tcp
      port: 9000
      protocol: TCP
      nodePort: null
    - name: tcp-mysql
      targetPort: tcp-mysql
      port: 9004
      protocol: TCP
      nodePort: null
    - name: tcp-postgresql
      targetPort: tcp-postgresql
      port: 9005
      protocol: TCP
      nodePort: null
    - name: http-intersrv
      targetPort: http-intersrv
      port: 9009
      protocol: TCP
      nodePort: null
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/component: clickhouse
---
# Source: langfuse/charts/postgresql/templates/primary/svc-headless.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-postgresql-hl
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/version: 17.3.0
    helm.sh/chart: postgresql-16.4.9
    app.kubernetes.io/component: primary
  annotations:
spec:
  type: ClusterIP
  clusterIP: None
  # We want all pods in the StatefulSet to have their addresses published for
  # the sake of the other Postgresql pods even before they're ready, since they
  # have to be able to talk to each other in order to become ready.
  publishNotReadyAddresses: true
  ports:
    - name: tcp-postgresql
      port: 5432
      targetPort: tcp-postgresql
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/component: primary
---
# Source: langfuse/charts/postgresql/templates/primary/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-postgresql
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/version: 17.3.0
    helm.sh/chart: postgresql-16.4.9
    app.kubernetes.io/component: primary
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: tcp-postgresql
      port: 5432
      targetPort: tcp-postgresql
      nodePort: null
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/component: primary
---
# Source: langfuse/charts/redis/templates/headless-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-redis-headless
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/part-of: valkey
spec:
  type: ClusterIP
  clusterIP: None
  ports:
    - name: tcp-redis
      port:  6379
      targetPort: redis
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: redis
---
# Source: langfuse/charts/redis/templates/primary/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-redis-primary
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/component: primary
    app.kubernetes.io/part-of: valkey
spec:
  type: ClusterIP
  internalTrafficPolicy: Cluster
  sessionAffinity: None
  ports:
    - name: tcp-redis
      port: 6379
      targetPort: redis
      nodePort: null
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: redis
    app.kubernetes.io/component: primary
---
# Source: langfuse/charts/s3/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
spec:
  type: ClusterIP
  ports:
    - name: minio-api
      port: 9000
      targetPort: minio-api
      nodePort: null
    - name: minio-console
      port: 9001
      targetPort: minio-console
      nodePort: null
  selector:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/name: s3
---
# Source: langfuse/templates/web/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: langfuse-web
  namespace: default
  labels:
    helm.sh/chart: langfuse-1.5.12
    app.kubernetes.io/name: langfuse
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/version: "3.133.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 3000
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: langfuse
    app.kubernetes.io/instance: langfuse
    app: web
---
# Source: langfuse/charts/s3/templates/standalone/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: langfuse-s3
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: s3
    app.kubernetes.io/version: 2024.12.18
    helm.sh/chart: s3-14.10.5
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: s3
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: langfuse
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: s3
        app.kubernetes.io/version: 2024.12.18
        helm.sh/chart: s3-14.10.5
      annotations:
        checksum/credentials-secret: 38c9f6da3534dcda6ff5d4f1226bd19a18155a62661575c61de6e84e18f0c4b9
    spec:
      
      serviceAccountName: langfuse-s3
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/instance: langfuse
                    app.kubernetes.io/name: s3
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      automountServiceAccountToken: false
      securityContext:
        fsGroup: 1001
        fsGroupChangePolicy: OnRootMismatch
        supplementalGroups: []
        sysctls: []
      containers:
        - name: minio
          image: docker.io/bitnamilegacy/minio:2024.12.18-debian-12-r1
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 1001
            runAsNonRoot: true
            runAsUser: 1001
            seLinuxOptions: {}
            seccompProfile:
              type: RuntimeDefault
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: MINIO_SCHEME
              value: "http"
            - name: MINIO_FORCE_NEW_KEYS
              value: "no"
            - name: MINIO_API_PORT_NUMBER
              value: "9000"
            - name: MINIO_ROOT_USER
              valueFrom:
                secretKeyRef:
                  name: langfuse-s3
                  key: root-user
            - name: MINIO_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-s3
                  key: root-password
            - name: MINIO_DEFAULT_BUCKETS
              value: langfuse
            - name: MINIO_BROWSER
              value: "on"
            - name: MINIO_PROMETHEUS_AUTH_TYPE
              value: "public"
            - name: MINIO_CONSOLE_PORT_NUMBER
              value: "9001"
            - name: MINIO_DATA_DIR
              value: "/bitnami/minio/data"
          envFrom:
          ports:
            - name: minio-api
              containerPort: 9000
              protocol: TCP
            - name: minio-console
              containerPort: 9001
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /minio/health/live
              port: minio-api
              scheme: "HTTP"
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 5
          readinessProbe:
            tcpSocket:
              port: minio-api
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 5
          resources:
            limits:
              cpu: 375m
              ephemeral-storage: 2Gi
              memory: 384Mi
            requests:
              cpu: 250m
              ephemeral-storage: 50Mi
              memory: 256Mi
          volumeMounts:
            - name: empty-dir
              mountPath: /tmp
              subPath: tmp-dir
            - name: empty-dir
              mountPath: /opt/bitnami/minio/tmp
              subPath: app-tmp-dir
            - name: empty-dir
              mountPath: /.mc
              subPath: app-mc-dir
            - name: data
              mountPath: /bitnami/minio/data
      volumes:
        - name: empty-dir
          emptyDir: {}
        - name: data
          persistentVolumeClaim:
            claimName: langfuse-s3
---
# Source: langfuse/templates/web/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: langfuse-web
  namespace: default
  labels:
    helm.sh/chart: langfuse-1.5.12
    app.kubernetes.io/name: langfuse
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/version: "3.133.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/name: langfuse
      app.kubernetes.io/instance: langfuse
      app: web
  template:
    metadata:
      labels:
        app.kubernetes.io/name: langfuse
        app.kubernetes.io/instance: langfuse
        app: web
    spec:
      serviceAccountName: langfuse
      securityContext:
        {}
      containers:
        - name: langfuse-web
          securityContext:
            {}
          image: "langfuse/langfuse:3.133.0"
          imagePullPolicy: Always
          env:
            - name: NODE_ENV
              value: "production"
            - name: LANGFUSE_LOG_LEVEL
              value: "info"
            - name: LANGFUSE_LOG_FORMAT
              value: "text"
            - name: SALT
              valueFrom:
                secretKeyRef:
                  name: langfuse-general
                  key: salt
            - name: ENCRYPTION_KEY
              valueFrom:
                secretKeyRef:
                  name: langfuse-general
                  key: encryption-key
            - name: TELEMETRY_ENABLED
              value: "true"
            - name: AUTH_DISABLE_SIGNUP
              value: "false"
            - name: ENABLE_EXPERIMENTAL_FEATURES
              value: "false"
            - name: NEXTAUTH_URL
              value: "http://localhost:3000"
            - name: NEXTAUTH_SECRET
              valueFrom:
                secretKeyRef:
                  name: langfuse-nextauth-secret
                  key: nextauth-secret
            - name: DATABASE_HOST
              value: "langfuse-postgresql"
            - name: DATABASE_USERNAME
              value: "postgres"
            - name: DATABASE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-postgresql-auth
                  key: password
            - name: DATABASE_NAME
              value: "postgres_langfuse"
            - name: LANGFUSE_AUTO_POSTGRES_MIGRATION_DISABLED
              value: "false"
            
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-redis-auth
                  key: password
            - name: REDIS_TLS_ENABLED
              value: "false"
            - name: REDIS_CONNECTION_STRING
              value: "redis://default:$(REDIS_PASSWORD)@langfuse-redis-primary:6379/0"
            
            - name: CLICKHOUSE_MIGRATION_URL
              value: "clickhouse://langfuse-clickhouse:9000"
            - name: CLICKHOUSE_MIGRATION_SSL
              value: "false"
            - name: CLICKHOUSE_URL
              value: "http://langfuse-clickhouse:8123"
            - name: CLICKHOUSE_USER
              value: "default"
            - name: CLICKHOUSE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-clickhouse-auth
                  key: password
            
            - name: CLICKHOUSE_CLUSTER_ENABLED
              value: "false"
            - name: LANGFUSE_AUTO_CLICKHOUSE_MIGRATION_DISABLED
              value: "false"
            
            - name: LANGFUSE_S3_EVENT_UPLOAD_BUCKET
              value: "langfuse"
            - name: LANGFUSE_S3_EVENT_UPLOAD_REGION
              value: "auto"
            - name: LANGFUSE_S3_EVENT_UPLOAD_ENDPOINT
              value: "http://langfuse-s3:9000"
            - name: LANGFUSE_S3_EVENT_UPLOAD_ACCESS_KEY_ID
              value: "minio"
            - name: LANGFUSE_S3_EVENT_UPLOAD_SECRET_ACCESS_KEY
              value: ""
            - name: LANGFUSE_S3_EVENT_UPLOAD_FORCE_PATH_STYLE
              value: "true"
            - name: LANGFUSE_S3_BATCH_EXPORT_ENABLED
              value: "true"
            - name: LANGFUSE_S3_BATCH_EXPORT_BUCKET
              value: "langfuse"
            - name: LANGFUSE_S3_BATCH_EXPORT_REGION
              value: "auto"
            - name: LANGFUSE_S3_BATCH_EXPORT_ENDPOINT
              value: "http://langfuse-s3:9000"
            - name: LANGFUSE_S3_BATCH_EXPORT_ACCESS_KEY_ID
              value: "minio"
            - name: LANGFUSE_S3_BATCH_EXPORT_SECRET_ACCESS_KEY
              value: ""
            - name: LANGFUSE_S3_BATCH_EXPORT_FORCE_PATH_STYLE
              value: "true"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_BUCKET
              value: "langfuse"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_REGION
              value: "auto"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_ENDPOINT
              value: "http://langfuse-s3:9000"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_ACCESS_KEY_ID
              value: "minio"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_SECRET_ACCESS_KEY
              value: ""
            - name: LANGFUSE_S3_MEDIA_UPLOAD_FORCE_PATH_STYLE
              value: "true"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_MAX_CONTENT_LENGTH
              value: "1e+09"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_DOWNLOAD_URL_EXPIRY_SECONDS
              value: "3600"
            - name: LANGFUSE_S3_CONCURRENT_READS
              value: "50"
            - name: LANGFUSE_S3_CONCURRENT_WRITES
              value: "50"
            - name: PORT
              value: "3000"
            - name: HOSTNAME
              value: "0.0.0.0"
          ports:
            - name: http
              containerPort: 3000
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /api/public/health
              port: http
            initialDelaySeconds: 20
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /api/public/ready
              port: http
            initialDelaySeconds: 20
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 3
          resources:
            {}
---
# Source: langfuse/templates/worker/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: langfuse-worker
  namespace: default
  labels:
    helm.sh/chart: langfuse-1.5.12
    app.kubernetes.io/name: langfuse
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/version: "3.133.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/name: langfuse
      app.kubernetes.io/instance: langfuse
      app: worker
  template:
    metadata:
      labels:
        app.kubernetes.io/name: langfuse
        app.kubernetes.io/instance: langfuse
        app: worker
    spec:
      serviceAccountName: langfuse
      securityContext:
        {}
      containers:
        - name: langfuse-worker
          securityContext:
            {}
          image: "langfuse/langfuse-worker:3.133.0"
          imagePullPolicy: Always
          env:
            - name: NODE_ENV
              value: "production"
            - name: LANGFUSE_LOG_LEVEL
              value: "info"
            - name: LANGFUSE_LOG_FORMAT
              value: "text"
            - name: SALT
              valueFrom:
                secretKeyRef:
                  name: langfuse-general
                  key: salt
            - name: ENCRYPTION_KEY
              valueFrom:
                secretKeyRef:
                  name: langfuse-general
                  key: encryption-key
            - name: TELEMETRY_ENABLED
              value: "true"
            - name: AUTH_DISABLE_SIGNUP
              value: "false"
            - name: ENABLE_EXPERIMENTAL_FEATURES
              value: "false"
            - name: NEXTAUTH_URL
              value: "http://localhost:3000"
            - name: NEXTAUTH_SECRET
              valueFrom:
                secretKeyRef:
                  name: langfuse-nextauth-secret
                  key: nextauth-secret
            - name: DATABASE_HOST
              value: "langfuse-postgresql"
            - name: DATABASE_USERNAME
              value: "postgres"
            - name: DATABASE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-postgresql-auth
                  key: password
            - name: DATABASE_NAME
              value: "postgres_langfuse"
            - name: LANGFUSE_AUTO_POSTGRES_MIGRATION_DISABLED
              value: "false"
            
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-redis-auth
                  key: password
            - name: REDIS_TLS_ENABLED
              value: "false"
            - name: REDIS_CONNECTION_STRING
              value: "redis://default:$(REDIS_PASSWORD)@langfuse-redis-primary:6379/0"
            
            - name: CLICKHOUSE_MIGRATION_URL
              value: "clickhouse://langfuse-clickhouse:9000"
            - name: CLICKHOUSE_MIGRATION_SSL
              value: "false"
            - name: CLICKHOUSE_URL
              value: "http://langfuse-clickhouse:8123"
            - name: CLICKHOUSE_USER
              value: "default"
            - name: CLICKHOUSE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-clickhouse-auth
                  key: password
            
            - name: CLICKHOUSE_CLUSTER_ENABLED
              value: "false"
            - name: LANGFUSE_AUTO_CLICKHOUSE_MIGRATION_DISABLED
              value: "false"
            
            - name: LANGFUSE_S3_EVENT_UPLOAD_BUCKET
              value: "langfuse"
            - name: LANGFUSE_S3_EVENT_UPLOAD_REGION
              value: "auto"
            - name: LANGFUSE_S3_EVENT_UPLOAD_ENDPOINT
              value: "http://langfuse-s3:9000"
            - name: LANGFUSE_S3_EVENT_UPLOAD_ACCESS_KEY_ID
              value: "minio"
            - name: LANGFUSE_S3_EVENT_UPLOAD_SECRET_ACCESS_KEY
              value: ""
            - name: LANGFUSE_S3_EVENT_UPLOAD_FORCE_PATH_STYLE
              value: "true"
            - name: LANGFUSE_S3_BATCH_EXPORT_ENABLED
              value: "true"
            - name: LANGFUSE_S3_BATCH_EXPORT_BUCKET
              value: "langfuse"
            - name: LANGFUSE_S3_BATCH_EXPORT_REGION
              value: "auto"
            - name: LANGFUSE_S3_BATCH_EXPORT_ENDPOINT
              value: "http://langfuse-s3:9000"
            - name: LANGFUSE_S3_BATCH_EXPORT_ACCESS_KEY_ID
              value: "minio"
            - name: LANGFUSE_S3_BATCH_EXPORT_SECRET_ACCESS_KEY
              value: ""
            - name: LANGFUSE_S3_BATCH_EXPORT_FORCE_PATH_STYLE
              value: "true"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_BUCKET
              value: "langfuse"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_REGION
              value: "auto"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_ENDPOINT
              value: "http://langfuse-s3:9000"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_ACCESS_KEY_ID
              value: "minio"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_SECRET_ACCESS_KEY
              value: ""
            - name: LANGFUSE_S3_MEDIA_UPLOAD_FORCE_PATH_STYLE
              value: "true"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_MAX_CONTENT_LENGTH
              value: "1e+09"
            - name: LANGFUSE_S3_MEDIA_UPLOAD_DOWNLOAD_URL_EXPIRY_SECONDS
              value: "3600"
            - name: LANGFUSE_S3_CONCURRENT_READS
              value: "50"
            - name: LANGFUSE_S3_CONCURRENT_WRITES
              value: "50"
          ports:
            - name: http
              containerPort: 3030
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /api/health
              port: http
            initialDelaySeconds: 20
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 3
          resources:
            {}
---
# Source: langfuse/charts/clickhouse/charts/zookeeper/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: langfuse-zookeeper
  namespace: default
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: zookeeper
    app.kubernetes.io/version: 3.9.3
    helm.sh/chart: zookeeper-13.7.4
    app.kubernetes.io/component: zookeeper
    role: zookeeper
spec:
  replicas: 3
  revisionHistoryLimit: 10
  podManagementPolicy: Parallel
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: zookeeper
      app.kubernetes.io/component: zookeeper
  serviceName: langfuse-zookeeper-headless
  updateStrategy:
    rollingUpdate: {}
    type: RollingUpdate
  template:
    metadata:
      annotations:
      labels:
        app.kubernetes.io/instance: langfuse
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: zookeeper
        app.kubernetes.io/version: 3.9.3
        helm.sh/chart: zookeeper-13.7.4
        app.kubernetes.io/component: zookeeper
    spec:
      enableServiceLinks: true
      serviceAccountName: langfuse-zookeeper
      
      automountServiceAccountToken: false
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/instance: langfuse
                    app.kubernetes.io/name: zookeeper
                    app.kubernetes.io/component: zookeeper
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
        fsGroupChangePolicy: Always
        supplementalGroups: []
        sysctls: []
      initContainers:
      containers:
        - name: zookeeper
          image: docker.io/bitnamilegacy/zookeeper:3.9.3-debian-12-r8
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 1001
            runAsNonRoot: true
            runAsUser: 1001
            seLinuxOptions: {}
            seccompProfile:
              type: RuntimeDefault
          command:
            - /scripts/setup.sh
          resources:
            limits:
              cpu: 375m
              ephemeral-storage: 2Gi
              memory: 384Mi
            requests:
              cpu: 250m
              ephemeral-storage: 50Mi
              memory: 256Mi
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: ZOO_DATA_LOG_DIR
              value: ""
            - name: ZOO_PORT_NUMBER
              value: "2181"
            - name: ZOO_TICK_TIME
              value: "2000"
            - name: ZOO_INIT_LIMIT
              value: "10"
            - name: ZOO_SYNC_LIMIT
              value: "5"
            - name: ZOO_PRE_ALLOC_SIZE
              value: "65536"
            - name: ZOO_SNAPCOUNT
              value: "100000"
            - name: ZOO_MAX_CLIENT_CNXNS
              value: "60"
            - name: ZOO_4LW_COMMANDS_WHITELIST
              value: "srvr, mntr, ruok"
            - name: ZOO_LISTEN_ALLIPS_ENABLED
              value: "no"
            - name: ZOO_AUTOPURGE_INTERVAL
              value: "1"
            - name: ZOO_AUTOPURGE_RETAIN_COUNT
              value: "10"
            - name: ZOO_MAX_SESSION_TIMEOUT
              value: "40000"
            - name: ZOO_SERVERS
              value: langfuse-zookeeper-0.langfuse-zookeeper-headless.default.svc.cluster.local:2888:3888::1 langfuse-zookeeper-1.langfuse-zookeeper-headless.default.svc.cluster.local:2888:3888::2 langfuse-zookeeper-2.langfuse-zookeeper-headless.default.svc.cluster.local:2888:3888::3 
            - name: ZOO_ENABLE_AUTH
              value: "no"
            - name: ZOO_ENABLE_QUORUM_AUTH
              value: "no"
            - name: ZOO_HEAP_SIZE
              value: "1024"
            - name: ZOO_LOG_LEVEL
              value: "ERROR"
            - name: ALLOW_ANONYMOUS_LOGIN
              value: "yes"
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.name
            - name: ZOO_ADMIN_SERVER_PORT_NUMBER
              value: "8080"
          ports:
            - name: client
              containerPort: 2181
            - name: follower
              containerPort: 2888
            - name: election
              containerPort: 3888
            - name: http-admin
              containerPort: 8080
          livenessProbe:
            failureThreshold: 6
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - /bin/bash
                - -ec
                - ZOO_HC_TIMEOUT=3 /opt/bitnami/scripts/zookeeper/healthcheck.sh
          readinessProbe:
            failureThreshold: 6
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - /bin/bash
                - -ec
                - ZOO_HC_TIMEOUT=2 /opt/bitnami/scripts/zookeeper/healthcheck.sh
          volumeMounts:
            - name: empty-dir
              mountPath: /tmp
              subPath: tmp-dir
            - name: empty-dir
              mountPath: /opt/bitnami/zookeeper/conf
              subPath: app-conf-dir
            - name: empty-dir
              mountPath: /opt/bitnami/zookeeper/logs
              subPath: app-logs-dir
            - name: scripts
              mountPath: /scripts/setup.sh
              subPath: setup.sh
            - name: data
              mountPath: /bitnami/zookeeper
      volumes:
        - name: empty-dir
          emptyDir: {}
        - name: scripts
          configMap:
            name: langfuse-zookeeper-scripts
            defaultMode: 493
  volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: data
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: langfuse/charts/clickhouse/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: langfuse-clickhouse-shard0
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.2.1
    helm.sh/chart: clickhouse-8.0.5
    app.kubernetes.io/component: clickhouse
    shard: "0"
spec:
  replicas: 1
  podManagementPolicy: "Parallel"
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: clickhouse
      app.kubernetes.io/component: clickhouse
  serviceName: langfuse-clickhouse-headless
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/config: 66346023bb6891437c4c6fe6f15dd3949072677536062e162e6d7f17aaca5dbf
        checksum/config-extra: 01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b
        checksum/config-users-extra: 01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b
      labels:
        app.kubernetes.io/instance: langfuse
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: clickhouse
        app.kubernetes.io/version: 25.2.1
        helm.sh/chart: clickhouse-8.0.5
        app.kubernetes.io/component: clickhouse
        shard: "0"
    spec:
      serviceAccountName: langfuse-clickhouse
      
      automountServiceAccountToken: false
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/instance: langfuse
                    app.kubernetes.io/name: clickhouse
                    app.kubernetes.io/component: clickhouse
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
        fsGroupChangePolicy: Always
        supplementalGroups: []
        sysctls: []
      initContainers:
      containers:
        - name: clickhouse
          image: docker.io/bitnamilegacy/clickhouse:25.2.1-debian-12-r0
          imagePullPolicy: IfNotPresent
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 1001
            runAsNonRoot: true
            runAsUser: 1001
            seLinuxOptions: {}
            seccompProfile:
              type: RuntimeDefault
          command:
            - /scripts/setup.sh
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: CLICKHOUSE_HTTP_PORT
              value: "8123"
            - name: CLICKHOUSE_TCP_PORT
              value: "9000"
            - name: CLICKHOUSE_MYSQL_PORT
              value: "9004"
            - name: CLICKHOUSE_POSTGRESQL_PORT
              value: "9005"
            - name: CLICKHOUSE_INTERSERVER_HTTP_PORT
              value: "9009"
            - name: CLICKHOUSE_ADMIN_USER
              value: "default"
            - name: CLICKHOUSE_SHARD_ID
              value: "shard0"
            - name: CLICKHOUSE_REPLICA_ID
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: CLICKHOUSE_ADMIN_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-clickhouse-auth
                  key: password
            - name: KEEPER_NODE_0
              value: langfuse-zookeeper-0.langfuse-zookeeper-headless.default.svc.cluster.local
            - name: KEEPER_NODE_1
              value: langfuse-zookeeper-1.langfuse-zookeeper-headless.default.svc.cluster.local
            - name: KEEPER_NODE_2
              value: langfuse-zookeeper-2.langfuse-zookeeper-headless.default.svc.cluster.local
          envFrom:
          resources:
            limits:
              cpu: 1000m
              ephemeral-storage: 2Gi
              memory: 2Gi
            requests:
              cpu: 500m
              ephemeral-storage: 50Mi
              memory: 1Gi
          ports:
            - name: http
              containerPort: 8123
            - name: tcp
              containerPort: 9000
            - name: tcp-postgresql
              containerPort: 9005
            - name: tcp-mysql
              containerPort: 9004
            - name: http-intersrv
              containerPort: 9009
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            tcpSocket:
              port: http
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            httpGet:
              path: /ping
              port: http
          volumeMounts:
            - name: empty-dir
              mountPath: /opt/bitnami/clickhouse/etc
              subPath: app-conf-dir
            - name: empty-dir
              mountPath: /opt/bitnami/clickhouse/logs
              subPath: app-logs-dir
            - name: empty-dir
              mountPath: /opt/bitnami/clickhouse/tmp
              subPath: app-tmp-dir
            - name: empty-dir
              mountPath: /tmp
              subPath: tmp-dir
            - name: scripts
              mountPath: /scripts/setup.sh
              subPath: setup.sh
            - name: data
              mountPath: /bitnami/clickhouse
            - name: config
              mountPath: /bitnami/clickhouse/etc/conf.d/default
      volumes:
        - name: scripts
          configMap:
            name: langfuse-clickhouse-scripts
            defaultMode: 0755
        - name: empty-dir
          emptyDir: {}
        - name: config
          configMap:
            name: langfuse-clickhouse
  volumeClaimTemplates:    
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: data
        labels:
          app.kubernetes.io/instance: langfuse
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/component: clickhouse
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: langfuse/charts/postgresql/templates/primary/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: langfuse-postgresql
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/version: 17.3.0
    helm.sh/chart: postgresql-16.4.9
    app.kubernetes.io/component: primary
spec:
  replicas: 1
  serviceName: langfuse-postgresql-hl
  updateStrategy:
    rollingUpdate: {}
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: postgresql
      app.kubernetes.io/component: primary
  template:
    metadata:
      name: langfuse-postgresql
      labels:
        app.kubernetes.io/instance: langfuse
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: postgresql
        app.kubernetes.io/version: 17.3.0
        helm.sh/chart: postgresql-16.4.9
        app.kubernetes.io/component: primary
    spec:
      serviceAccountName: langfuse-postgresql
      
      automountServiceAccountToken: false
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/instance: langfuse
                    app.kubernetes.io/name: postgresql
                    app.kubernetes.io/component: primary
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
        fsGroupChangePolicy: Always
        supplementalGroups: []
        sysctls: []
      hostNetwork: false
      hostIPC: false
      containers:
        - name: postgresql
          image: docker.io/bitnamilegacy/postgresql:17.3.0-debian-12-r1
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 1001
            runAsNonRoot: true
            runAsUser: 1001
            seLinuxOptions: {}
            seccompProfile:
              type: RuntimeDefault
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: POSTGRESQL_PORT_NUMBER
              value: "5432"
            - name: POSTGRESQL_VOLUME_DIR
              value: "/bitnami/postgresql"
            - name: PGDATA
              value: "/bitnami/postgresql/data"
            # Authentication
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-postgresql-auth
                  key: password
            - name: POSTGRES_DATABASE
              value: "postgres_langfuse"
            # LDAP
            - name: POSTGRESQL_ENABLE_LDAP
              value: "no"
            # TLS
            - name: POSTGRESQL_ENABLE_TLS
              value: "no"
            # Audit
            - name: POSTGRESQL_LOG_HOSTNAME
              value: "false"
            - name: POSTGRESQL_LOG_CONNECTIONS
              value: "false"
            - name: POSTGRESQL_LOG_DISCONNECTIONS
              value: "false"
            - name: POSTGRESQL_PGAUDIT_LOG_CATALOG
              value: "off"
            # Others
            - name: POSTGRESQL_CLIENT_MIN_MESSAGES
              value: "error"
            - name: POSTGRESQL_SHARED_PRELOAD_LIBRARIES
              value: "pgaudit"
          ports:
            - name: tcp-postgresql
              containerPort: 5432
          livenessProbe:
            failureThreshold: 6
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - /bin/sh
                - -c
                - exec pg_isready -U "postgres" -d "dbname=postgres_langfuse" -h 127.0.0.1 -p 5432
          readinessProbe:
            failureThreshold: 6
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - /bin/sh
                - -c
                - -e
                - |
                  exec pg_isready -U "postgres" -d "dbname=postgres_langfuse" -h 127.0.0.1 -p 5432
          resources:
            limits:
              cpu: 500m
              memory: 1Gi
            requests:
              cpu: 250m
              memory: 512Mi
          volumeMounts:
            - name: empty-dir
              mountPath: /tmp
              subPath: tmp-dir
            - name: empty-dir
              mountPath: /opt/bitnami/postgresql/conf
              subPath: app-conf-dir
            - name: empty-dir
              mountPath: /opt/bitnami/postgresql/tmp
              subPath: app-tmp-dir
            - name: dshm
              mountPath: /dev/shm
            - name: data
              mountPath: /bitnami/postgresql
      volumes:
        - name: empty-dir
          emptyDir: {}
        - name: dshm
          emptyDir:
            medium: Memory
  volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: data
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: langfuse/charts/redis/templates/primary/application.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: langfuse-redis-primary
  namespace: "default"
  labels:
    app.kubernetes.io/instance: langfuse
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redis
    app.kubernetes.io/version: 8.0.2
    helm.sh/chart: redis-2.2.4
    app.kubernetes.io/component: primary
    app.kubernetes.io/part-of: valkey
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: langfuse
      app.kubernetes.io/name: redis
      app.kubernetes.io/component: primary
  serviceName: langfuse-redis-headless
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: langfuse
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redis
        app.kubernetes.io/version: 8.0.2
        helm.sh/chart: redis-2.2.4
        app.kubernetes.io/component: primary
      annotations:
        checksum/configmap: c8cdc0c4c772ac3192446a08bf401c29f1e39f33614657d36e4bb1692e34b39f
        checksum/health: e3a0f06458110f02986bb8df4391c43567355d3582dd02f25447184391196fbc
        checksum/scripts: 7a413afc2606007753c903c5b45cb419023d8be9ac534341770543056c956d3e
        checksum/secret: 44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a
    spec:
      
      securityContext:
        fsGroup: 1001
        fsGroupChangePolicy: Always
        supplementalGroups: []
        sysctls: []
      serviceAccountName: langfuse-redis-primary
      automountServiceAccountToken: false
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/instance: langfuse
                    app.kubernetes.io/name: redis
                    app.kubernetes.io/component: primary
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      enableServiceLinks: true
      terminationGracePeriodSeconds: 30
      containers:
        - name: valkey
          image: docker.io/bitnamilegacy/valkey:8.0.2-debian-12-r2
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
            runAsGroup: 1001
            runAsNonRoot: true
            runAsUser: 1001
            seLinuxOptions: {}
            seccompProfile:
              type: RuntimeDefault
          command:
            - /bin/bash
          args:
            - -c
            - /opt/bitnami/scripts/start-scripts/start-primary.sh
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: VALKEY_REPLICATION_MODE
              value: primary
            - name: ALLOW_EMPTY_PASSWORD
              value: "no"
            - name: VALKEY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: langfuse-redis-auth
                  key: password
            - name: VALKEY_TLS_ENABLED
              value: "no"
            - name: VALKEY_PORT
              value: "6379"
          ports:
            - name: redis
              containerPort: 6379
          livenessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            # One second longer than command timeout should prevent generation of zombie processes.
            timeoutSeconds: 6
            successThreshold: 1
            failureThreshold: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_liveness_local.sh 5
          readinessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 2
            successThreshold: 1
            failureThreshold: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_readiness_local.sh 1
          resources:
            limits:
              cpu: 150m
              ephemeral-storage: 2Gi
              memory: 192Mi
            requests:
              cpu: 100m
              ephemeral-storage: 50Mi
              memory: 128Mi
          volumeMounts:
            - name: start-scripts
              mountPath: /opt/bitnami/scripts/start-scripts
            - name: health
              mountPath: /health
            - name: valkey-data
              mountPath: /data
            - name: config
              mountPath: /opt/bitnami/valkey/mounted-etc
            - name: empty-dir
              mountPath: /opt/bitnami/valkey/etc/
              subPath: app-conf-dir
            - name: empty-dir
              mountPath: /tmp
              subPath: tmp-dir
      volumes:
        - name: start-scripts
          configMap:
            name: langfuse-redis-scripts
            defaultMode: 0755
        - name: health
          configMap:
            name: langfuse-redis-health
            defaultMode: 0755
        - name: config
          configMap:
            name: langfuse-redis-configuration
        - name: empty-dir
          emptyDir: {}
  volumeClaimTemplates:
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: valkey-data
        labels:
          app.kubernetes.io/instance: langfuse
          app.kubernetes.io/name: redis
          app.kubernetes.io/component: primary
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: langfuse/templates/validations.yaml
# Validate Langfuse Server settings# Validate auth providers settings# Validate ClickHouse settings# Validate Redis settings# Validate Redis Cluster settings# Validate S3 settings
# Storage Provider#   Event Upload#   Batch Export#   Media Upload# Validate that only one of additionalEnv or new structure is configured for PostgreSQL# Validate that only one of additionalEnv or new structure is configured for Redis# Validate that only one of additionalEnv or new structure is configured for ClickHouse# Validate that only one of additionalEnv or new structure is configured for S3/MinIO
## Event Upload - Check both specific and global settings## Batch Export - Check both specific and global settings## Media Upload - Check both specific and global settings# Validate that only one of additionalEnv or new structure is configured for Feature Flags# Validate that only one of additionalEnv or new structure is configured for SMTP config# Validate that only one of additionalEnv or new structure is configured for Allowed Organization Creators# Validate that only one of additionalEnv or new structure is configured for Authentication and Security# Validate scaling configurations
